{
  "type": "composition",
  "npmDependencies": [
    "@tiptap/react",
    "react-icons"
  ],
  "fileDependencies": [
    "compositions/ui/rich-text-editor-context",
    "compositions/ui/tooltip"
  ],
  "id": "rich-text-editor-control",
  "file": {
    "name": "rich-text-editor-control.tsx",
    "content": "\"use client\"\n\nimport type { IconButtonProps } from \"@chakra-ui/react\"\nimport {\n  Box,\n  CloseButton,\n  ColorSwatch,\n  HStack,\n  IconButton,\n  Popover,\n  Portal,\n  Select,\n  VStack,\n  createListCollection,\n} from \"@chakra-ui/react\"\nimport { Editor } from \"@tiptap/react\"\nimport { useRichTextEditorContext } from \"./rich-text-editor-context\"\nimport { Tooltip } from \"compositions/ui/tooltip\"\nimport * as React from \"react\"\nimport {\n  LuAlignCenter,\n  LuAlignJustify,\n  LuAlignLeft,\n  LuAlignRight,\n  LuBold,\n  LuCode,\n  LuHeading1,\n  LuHeading2,\n  LuHeading3,\n  LuHeading4,\n  LuHighlighter,\n  LuItalic,\n  LuLink,\n  LuLink2,\n  LuList,\n  LuListOrdered,\n  LuMinus,\n  LuQuote,\n  LuRotateCcw,\n  LuRotateCw,\n  LuStrikethrough,\n  LuSubscript,\n  LuSuperscript,\n  LuType,\n  LuUnderline,\n} from \"react-icons/lu\"\n\nexport interface BaseControlConfig {\n  label: string\n  icon?: React.ElementType\n  isDisabled?: (editor: Editor) => boolean\n  getProps?: (editor: Editor) => Record<string, any>\n}\n\nexport interface ButtonControlProps\n  extends Omit<IconButtonProps, \"aria-label\"> {\n  icon: React.ReactNode\n  label: string\n}\n\nexport const ButtonControl = React.forwardRef<\n  HTMLButtonElement,\n  ButtonControlProps\n>(function ButtonControl(props, ref) {\n  const { icon, label, ...rest } = props\n  return (\n    <Tooltip content={label}>\n      <IconButton ref={ref} size=\"2xs\" aria-label={label} {...rest}>\n        {icon}\n      </IconButton>\n    </Tooltip>\n  )\n})\n\n///////////////////// Boolean Control /////////////////////\n\nexport interface BooleanControlConfig extends BaseControlConfig {\n  icon: React.ElementType\n  command: (editor: Editor) => void\n  getVariant?: (editor: Editor) => IconButtonProps[\"variant\"]\n}\n\nexport function createBooleanControl(config: BooleanControlConfig) {\n  const {\n    label,\n    icon: Icon,\n    isDisabled,\n    command,\n    getVariant,\n    getProps,\n  } = config\n\n  const BooleanControl = React.forwardRef<HTMLButtonElement, IconButtonProps>(\n    function BooleanControl(props, ref) {\n      const { editor } = useRichTextEditorContext()\n      if (!editor) return null\n      const disabled = isDisabled ? isDisabled(editor) : false\n      const dynamicProps = getProps ? getProps(editor) : {}\n      const variant =\n        getVariant && !getProps ? getVariant(editor) : dynamicProps.variant\n\n      return (\n        <ButtonControl\n          ref={ref}\n          label={label}\n          icon={<Icon />}\n          variant={variant}\n          onClick={() => command(editor)}\n          disabled={disabled}\n          {...props}\n        />\n      )\n    },\n  )\n\n  BooleanControl.displayName = `BooleanControl(${label})`\n  return BooleanControl\n}\n\n///////////////////// Select Control (with options) /////////////////////\n\nexport interface SelectOption {\n  value: string\n  label: string\n  icon?: React.ReactNode\n}\n\nexport interface SelectControlConfig extends BaseControlConfig {\n  options: SelectOption[]\n  width?: Select.RootProps[\"width\"]\n  getValue: (editor: Editor) => string\n  command: (editor: Editor, value: string) => void\n  placeholder?: string\n  renderValue?: (value: string, option?: SelectOption) => React.ReactNode\n}\n\nexport function createSelectControl(config: SelectControlConfig) {\n  const {\n    label,\n    options,\n    width,\n    getValue,\n    command,\n    placeholder = \"Select\",\n    renderValue,\n    isDisabled,\n    getProps,\n  } = config\n\n  const SelectControl = React.forwardRef<\n    HTMLButtonElement,\n    Omit<Select.RootProps, \"collection\">\n  >(function SelectControl(props, ref) {\n    const { editor } = useRichTextEditorContext()\n    const controlId = React.useId()\n\n    if (!editor) return null\n\n    const currentValue = getValue(editor)\n    const disabled = isDisabled ? isDisabled(editor) : false\n\n    const currentOption = options.find((o) => o.value === currentValue)\n    const displayValue =\n      renderValue && currentOption\n        ? renderValue(currentValue, currentOption)\n        : currentOption?.label || placeholder\n\n    const collection = createListCollection({ items: options })\n    const dynamicProps = getProps ? getProps(editor) : {}\n\n    return (\n      <Select.Root\n        width={width}\n        {...props}\n        size=\"xs\"\n        variant=\"ghost\"\n        collection={collection}\n        value={[currentValue]}\n        onValueChange={(details) => command(editor, details.value[0])}\n        disabled={disabled}\n        ids={{ trigger: controlId }}\n        positioning={{ sameWidth: false }}\n        css={{\n          \"--select-trigger-height\": \"sizes.6\",\n          \"--select-trigger-padding-x\": \"spacing.2\",\n        }}\n        {...dynamicProps}\n      >\n        <Tooltip content={label} ids={{ trigger: controlId }}>\n          <Select.Trigger ref={ref}>\n            <Select.ValueText>{displayValue}</Select.ValueText>\n            <Select.Indicator />\n          </Select.Trigger>\n        </Tooltip>\n        <Portal>\n          <Select.Positioner>\n            <Select.Content minW=\"20\">\n              {options.map((opt) => (\n                <Select.Item key={opt.value} item={opt.value}>\n                  {opt.icon && (\n                    <Box as=\"span\" marginEnd=\"2\">\n                      {opt.icon}\n                    </Box>\n                  )}\n                  <Select.ItemText>{opt.label}</Select.ItemText>\n                </Select.Item>\n              ))}\n            </Select.Content>\n          </Select.Positioner>\n        </Portal>\n      </Select.Root>\n    )\n  })\n\n  SelectControl.displayName = `SelectControl(${label})`\n  return SelectControl\n}\n\n///////////////////// Swatch Control (with color swatches) /////////////////////\n\nexport interface SwatchOption {\n  value: string\n  color: string\n  label?: string\n}\nexport interface SwatchControlConfig extends BaseControlConfig {\n  swatches: SwatchOption[]\n  getValue: (editor: Editor) => string\n  command: (editor: Editor, value: string) => void\n  showRemove?: boolean\n  onRemove?: (editor: Editor) => void\n}\n\nexport function createSwatchControl(config: SwatchControlConfig) {\n  const {\n    label,\n    swatches,\n    getValue,\n    command,\n    showRemove = false,\n    onRemove,\n    isDisabled,\n    icon: Icon,\n    getProps,\n  } = config\n\n  const SwatchControl = React.forwardRef<HTMLButtonElement, IconButtonProps>(\n    function SwatchControl(props, ref) {\n      const { editor } = useRichTextEditorContext()\n      const [open, setOpen] = React.useState(false)\n      const triggerId = React.useId()\n\n      if (!editor) return null\n      const currentValue = getValue(editor)\n      const disabled = isDisabled ? isDisabled(editor) : false\n      const dynamicProps = getProps ? getProps(editor) : {}\n\n      return (\n        <Popover.Root\n          open={open}\n          onOpenChange={(e) => setOpen(e.open)}\n          ids={{ trigger: triggerId }}\n          size=\"sm\"\n        >\n          <Tooltip content={label} ids={{ trigger: triggerId }}>\n            <Popover.Trigger asChild>\n              <IconButton\n                ref={ref}\n                size=\"2xs\"\n                aria-label={label}\n                disabled={disabled}\n                {...dynamicProps}\n                {...props}\n              >\n                <VStack gap=\"1px\">\n                  {Icon && <Icon />}\n                  <ColorSwatch value={currentValue} h=\"4px\" w=\"100%\" />\n                </VStack>\n              </IconButton>\n            </Popover.Trigger>\n          </Tooltip>\n\n          <Portal>\n            <Popover.Positioner>\n              <Popover.Content width=\"auto\">\n                <Popover.Body>\n                  <HStack wrap=\"wrap\">\n                    {swatches.map((swatch) => (\n                      <ColorSwatch\n                        key={swatch.value}\n                        cursor=\"button\"\n                        value={swatch.color}\n                        onClick={() => {\n                          command(editor, swatch.value)\n                          setOpen(false)\n                        }}\n                      />\n                    ))}\n                    {showRemove && onRemove && (\n                      <Popover.CloseTrigger asChild>\n                        <CloseButton\n                          size=\"2xs\"\n                          onClick={() => {\n                            onRemove(editor)\n                            setOpen(false)\n                          }}\n                        />\n                      </Popover.CloseTrigger>\n                    )}\n                  </HStack>\n                </Popover.Body>\n              </Popover.Content>\n            </Popover.Positioner>\n          </Portal>\n        </Popover.Root>\n      )\n    },\n  )\n\n  SwatchControl.displayName = `SwatchControl(${label || \"Unnamed\"})`\n  return SwatchControl\n}\n\nexport const FontFamily = createSelectControl({\n  label: \"Font Family\",\n  width: \"80px\",\n  options: [\n    { value: \"default\", label: \"Default\" },\n    { value: \"serif\", label: \"Serif\" },\n    { value: \"mono\", label: \"Monospace\" },\n    { value: \"cursive\", label: \"Cursive\" },\n  ],\n  getValue: (editor) =>\n    editor.getAttributes(\"textStyle\")?.fontFamily || \"default\",\n  command: (editor, value) =>\n    value === \"default\"\n      ? editor.chain().focus().unsetFontFamily().run()\n      : editor.chain().focus().setFontFamily(value).run(),\n})\n\nexport const FontSize = createSelectControl({\n  label: \"Font Size\",\n  width: \"64px\",\n  options: [\n    { value: \"12px\", label: \"12px\" },\n    { value: \"14px\", label: \"14px\" },\n    { value: \"16px\", label: \"16px\" },\n    { value: \"18px\", label: \"18px\" },\n  ],\n  getValue: (editor) => editor.getAttributes(\"textStyle\")?.fontSize || \"14px\",\n  command: (editor, value) =>\n    editor.chain().focus().setMark(\"textStyle\", { fontSize: value }).run(),\n})\n\nexport const Bold = createBooleanControl({\n  label: \"Bold\",\n  icon: LuBold,\n  command: (editor) => editor.chain().focus().toggleBold().run(),\n  getVariant: (editor) => (editor.isActive(\"bold\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Italic = createBooleanControl({\n  label: \"Italic\",\n  icon: LuItalic,\n  command: (editor) => editor.chain().focus().toggleItalic().run(),\n  getVariant: (editor) => (editor.isActive(\"italic\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Underline = createBooleanControl({\n  label: \"Underline\",\n  icon: LuUnderline,\n  command: (editor) => editor.chain().focus().toggleUnderline().run(),\n  getVariant: (editor) => (editor.isActive(\"underline\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Strikethrough = createBooleanControl({\n  label: \"Strikethrough\",\n  icon: LuStrikethrough,\n  command: (editor) => editor.chain().focus().toggleStrike().run(),\n  getVariant: (editor) => (editor.isActive(\"strike\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Code = createBooleanControl({\n  label: \"Code\",\n  icon: LuCode,\n  command: (editor) => editor.chain().focus().toggleCode().run(),\n  getVariant: (editor) => (editor.isActive(\"code\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Subscript = createBooleanControl({\n  label: \"Subscript\",\n  icon: LuSubscript,\n  command: (editor) => editor.chain().focus().toggleSubscript().run(),\n  getVariant: (editor) => (editor.isActive(\"subscript\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Superscript = createBooleanControl({\n  label: \"Superscript\",\n  icon: LuSuperscript,\n  command: (editor) => editor.chain().focus().toggleSuperscript().run(),\n  getVariant: (editor) => (editor.isActive(\"superscript\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const H1 = createBooleanControl({\n  label: \"H1\",\n  icon: LuHeading1,\n  command: (editor) => editor.chain().focus().toggleHeading({ level: 1 }).run(),\n  getVariant: (editor) =>\n    editor.isActive(\"heading\", { level: 1 }) ? \"subtle\" : \"ghost\",\n})\n\nexport const H2 = createBooleanControl({\n  label: \"H2\",\n  icon: LuHeading2,\n  command: (editor) => editor.chain().focus().toggleHeading({ level: 2 }).run(),\n  getVariant: (editor) =>\n    editor.isActive(\"heading\", { level: 2 }) ? \"subtle\" : \"ghost\",\n})\n\nexport const H3 = createBooleanControl({\n  label: \"H3\",\n  icon: LuHeading3,\n  command: (editor) => editor.chain().focus().toggleHeading({ level: 3 }).run(),\n  getVariant: (editor) =>\n    editor.isActive(\"heading\", { level: 3 }) ? \"subtle\" : \"ghost\",\n})\n\nexport const H4 = createBooleanControl({\n  label: \"H4\",\n  icon: LuHeading4,\n  command: (editor) => editor.chain().focus().toggleHeading({ level: 4 }).run(),\n  getVariant: (editor) =>\n    editor.isActive(\"heading\", { level: 4 }) ? \"subtle\" : \"ghost\",\n})\n\nexport const BulletList = createBooleanControl({\n  label: \"Bullet List\",\n  icon: LuList,\n  command: (editor) => editor.chain().focus().toggleBulletList().run(),\n  getVariant: (editor) => (editor.isActive(\"bulletList\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const OrderedList = createBooleanControl({\n  label: \"Ordered List\",\n  icon: LuListOrdered,\n  command: (editor) => editor.chain().focus().toggleOrderedList().run(),\n  getVariant: (editor) => (editor.isActive(\"orderedList\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Blockquote = createBooleanControl({\n  label: \"Blockquote\",\n  icon: LuQuote,\n  command: (editor) => editor.chain().focus().toggleBlockquote().run(),\n  getVariant: (editor) => (editor.isActive(\"blockquote\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Hr = createBooleanControl({\n  label: \"Horizontal Rule\",\n  icon: LuMinus,\n  command: (editor) => editor.chain().focus().setHorizontalRule().run(),\n  getVariant: (editor) => (editor.isActive(\"blockquote\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Link = createBooleanControl({\n  label: \"Link\",\n  icon: LuLink,\n  command: (editor) => {\n    const url = window.prompt(\"Enter URL\")\n    if (url)\n      editor\n        .chain()\n        .focus()\n        .extendMarkRange(\"link\")\n        .setLink({ href: url })\n        .run()\n  },\n  getVariant: (editor) => (editor.isActive(\"link\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Unlink = createBooleanControl({\n  label: \"Unlink\",\n  icon: LuLink2,\n  command: (editor) => editor.chain().focus().unsetLink().run(),\n  getVariant: (editor) => (editor.isActive(\"link\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const AlignLeft = createBooleanControl({\n  label: \"Align Left\",\n  icon: LuAlignLeft,\n  command: (editor) => editor.chain().focus().setTextAlign(\"left\").run(),\n  getVariant: (editor) =>\n    editor.isActive({ textAlign: \"left\" }) ? \"subtle\" : \"ghost\",\n})\n\nexport const AlignCenter = createBooleanControl({\n  label: \"Align Center\",\n  icon: LuAlignCenter,\n  command: (editor) => editor.chain().focus().setTextAlign(\"center\").run(),\n  getVariant: (editor) =>\n    editor.isActive({ textAlign: \"center\" }) ? \"subtle\" : \"ghost\",\n})\n\nexport const AlignJustify = createBooleanControl({\n  label: \"Align Justify\",\n  icon: LuAlignJustify,\n  command: (editor) => editor.chain().focus().setTextAlign(\"justify\").run(),\n  getVariant: (editor) =>\n    editor.isActive({ textAlign: \"justify\" }) ? \"subtle\" : \"ghost\",\n})\n\nexport const AlignRight = createBooleanControl({\n  label: \"Align Right\",\n  icon: LuAlignRight,\n  command: (editor) => editor.chain().focus().setTextAlign(\"right\").run(),\n  getVariant: (editor) =>\n    editor.isActive({ textAlign: \"right\" }) ? \"subtle\" : \"ghost\",\n})\n\nexport const Undo = createBooleanControl({\n  label: \"Undo\",\n  icon: LuRotateCcw,\n  command: (editor) => editor.chain().focus().undo().run(),\n  isDisabled: (editor) => !editor.can().undo(),\n  getVariant: (editor) => (editor.isActive(\"link\") ? \"subtle\" : \"ghost\"),\n})\n\nexport const Redo = createBooleanControl({\n  label: \"Redo\",\n  icon: LuRotateCw,\n  command: (editor) => editor.chain().focus().redo().run(),\n  isDisabled: (editor) => !editor.can().redo(),\n  getVariant: (editor) => (editor.isActive(\"link\") ? \"subtle\" : \"ghost\"),\n})\n\nconst SWATCH_OPTIONS = [\n  { label: \"Black\", value: \"#000000\", color: \"#000000\" },\n  { label: \"Red\", value: \"#FF0000\", color: \"#FF0000\" },\n  { label: \"Green\", value: \"#00FF00\", color: \"#00FF00\" },\n  { label: \"Blue\", value: \"#0000FF\", color: \"#0000FF\" },\n  { label: \"Yellow\", value: \"#FFFF00\", color: \"#FFFF00\" },\n  { label: \"Purple\", value: \"#800080\", color: \"#800080\" },\n  { label: \"Orange\", value: \"#FFA500\", color: \"#FFA500\" },\n]\n\nexport const TextColor = createSwatchControl({\n  label: \"Text Color\",\n  swatches: SWATCH_OPTIONS,\n  getValue: (editor) => {\n    const color = editor.getAttributes(\"textStyle\")?.color\n    return color || \"\"\n  },\n  getProps: (editor) => ({\n    variant: editor.getAttributes(\"textStyle\")?.color ? \"subtle\" : \"ghost\",\n  }),\n  command: (editor, color) =>\n    editor.chain().focus().setMark(\"textStyle\", { color }).run(),\n  icon: LuType,\n  onRemove: (editor) => editor.chain().focus().unsetMark(\"textStyle\").run(),\n})\n\nconst HIGHLIGHT_SWATCH_OPTIONS = [\n  { label: \"Yellow\", value: \"#FFFF00\", color: \"#FFFF00\" },\n  { label: \"Green\", value: \"#00FF00\", color: \"#00FF00\" },\n  { label: \"Cyan\", value: \"#00FFFF\", color: \"#00FFFF\" },\n  { label: \"Pink\", value: \"#FF69B4\", color: \"#FF69B4\" },\n  { label: \"Orange\", value: \"#FFA500\", color: \"#FFA500\" },\n  { label: \"Purple\", value: \"#DDA0DD\", color: \"#DDA0DD\" },\n]\n\nexport const Highlight = createSwatchControl({\n  label: \"Highlight\",\n  swatches: HIGHLIGHT_SWATCH_OPTIONS,\n  getValue: (editor) => {\n    const color = editor.getAttributes(\"highlight\")?.color\n    return color || \"\"\n  },\n  getProps: (editor) => ({\n    variant: editor.getAttributes(\"highlight\")?.color ? \"subtle\" : \"ghost\",\n  }),\n  command: (editor, color) =>\n    editor.chain().focus().toggleHighlight({ color }).run(),\n  icon: LuHighlighter,\n  showRemove: true,\n  onRemove: (editor) => editor.chain().focus().unsetHighlight().run(),\n})\n\nconst TEXT_STYLE_OPTIONS = [\n  { value: \"paragraph\", label: \"Paragraph\" },\n  { value: \"heading1\", label: \"Heading 1\" },\n  { value: \"heading2\", label: \"Heading 2\" },\n  { value: \"heading3\", label: \"Heading 3\" },\n  { value: \"blockquote\", label: \"Quote\" },\n  { value: \"horizontalRule\", label: \"Divider\", icon: <LuMinus /> },\n]\n\nexport const TextStyle = createSelectControl({\n  label: \"Text Style\",\n  width: \"120px\",\n  placeholder: \"Paragraph\",\n  options: TEXT_STYLE_OPTIONS,\n  getValue: (editor) => {\n    if (editor.isActive(\"heading\", { level: 1 })) return \"heading1\"\n    if (editor.isActive(\"heading\", { level: 2 })) return \"heading2\"\n    if (editor.isActive(\"heading\", { level: 3 })) return \"heading3\"\n    if (editor.isActive(\"blockquote\")) return \"blockquote\"\n    return \"paragraph\"\n  },\n  command: (editor, value) => {\n    if (value === \"paragraph\") {\n      editor.chain().focus().setParagraph().run()\n    } else if (value === \"heading1\") {\n      editor.chain().focus().toggleHeading({ level: 1 }).run()\n    } else if (value === \"heading2\") {\n      editor.chain().focus().toggleHeading({ level: 2 }).run()\n    } else if (value === \"heading3\") {\n      editor.chain().focus().toggleHeading({ level: 3 }).run()\n    } else if (value === \"blockquote\") {\n      editor.chain().focus().toggleBlockquote().run()\n    } else if (value === \"horizontalRule\") {\n      editor.chain().focus().setHorizontalRule().run()\n    }\n  },\n  renderValue: (value, option) => {\n    const textStyle: any = {\n      paragraph: { fontWeight: \"normal\", fontSize: \"sm\" },\n      heading1: { fontWeight: \"bold\", fontSize: \"lg\" },\n      heading2: { fontWeight: \"semibold\", fontSize: \"md\" },\n      heading3: { fontWeight: \"medium\", fontSize: \"sm\" },\n      blockquote: { fontStyle: \"italic\", fontSize: \"sm\" },\n      horizontalRule: { fontWeight: \"medium\", fontSize: \"sm\" },\n    }\n    return <Box {...textStyle[value]}>{option?.label || \"Paragraph\"}</Box>\n  },\n})\n"
  },
  "component": "RichTextEditorControl"
}