{
  "type": "composition",
  "npmDependencies": [
    "@tiptap/react"
  ],
  "fileDependencies": [
    "compositions/ui/tooltip"
  ],
  "id": "rich-text-editor",
  "file": {
    "name": "rich-text-editor.tsx",
    "content": "\"use client\"\n\nimport type { BoxProps, IconButtonProps, StackProps } from \"@chakra-ui/react\"\nimport {\n  Box,\n  CloseButton,\n  ColorSwatch,\n  HStack,\n  IconButton,\n  Popover,\n  Portal,\n  Select,\n  StackSeparator,\n  VStack,\n  createListCollection,\n  defineStyle,\n} from \"@chakra-ui/react\"\nimport { Editor, EditorContent } from \"@tiptap/react\"\nimport { Tooltip } from \"./tooltip\"\nimport * as React from \"react\"\n\nexport interface RichTextEditorContextValue {\n  editor: Editor | null\n}\n\nconst RichTextEditorContext =\n  React.createContext<RichTextEditorContextValue | null>(null)\nRichTextEditorContext.displayName = \"RichTextEditorContext\"\n\nexport function useRichTextEditorContext() {\n  const context = React.useContext(RichTextEditorContext)\n  if (!context) {\n    throw new Error(\n      \"useRichTextEditorContext must be used within a RichTextEditorRoot\",\n    )\n  }\n  return context\n}\n\nconst proseMirrorBaseCss = defineStyle({\n  display: \"flex\",\n  flexDirection: \"column\",\n  borderWidth: \"1px\",\n  rounded: \"l2\",\n  lineHeight: \"1.5\",\n\n  \"--content-padding-x\": \"spacing.5\",\n  \"--content-padding-y\": \"spacing.5\",\n\n  \"& img.ProseMirror-selectednode\": {\n    outlineWidth: \"2px\",\n    outlineStyle: \"solid\",\n    outlineColor: \"blue.focusRing\",\n  },\n\n  \"& .ProseMirror\": {\n    outline: \"none\",\n    minHeight: \"var(--content-min-height)\",\n    px: \"var(--content-padding-x)\",\n    py: \"var(--content-padding-y)\",\n    \"& > * + *\": { marginTop: \"0.75em\" },\n    \"& h1\": {\n      fontSize: \"2.15em\",\n      letterSpacing: \"-0.02em\",\n      lineHeight: \"1.2em\",\n    },\n    \"& h2\": {\n      fontSize: \"1.4em\",\n      letterSpacing: \"-0.02em\",\n      lineHeight: \"1.4em\",\n    },\n    \"& h3\": {\n      fontSize: \"1.285em\",\n      letterSpacing: \"-0.01em\",\n      lineHeight: \"1.5em\",\n    },\n    \"& h4\": {\n      fontSize: \"1.14em\",\n      letterSpacing: \"-0.01em\",\n      lineHeight: \"1.5em\",\n    },\n    \"& h5\": {\n      fontSize: \"1em\",\n      letterSpacing: \"-0.01em\",\n      lineHeight: \"1.5em\",\n    },\n    \"& h6\": {\n      fontSize: \"0.85em\",\n      letterSpacing: \"-0.01em\",\n      lineHeight: \"1.5em\",\n    },\n    \"& h1, h2, h3, h4, h5, h6\": {\n      color: \"fg\",\n      fontWeight: \"600\",\n    },\n    \"& code\": {\n      bg: \"bg.muted\",\n      paddingInline: \"0.25em\",\n      rounded: \"sm\",\n      fontFamily: \"mono\",\n      fontSize: \"0.9em\",\n      borderWidth: \"1px\",\n    },\n    \"& pre\": {\n      bg: \"gray.900\",\n      color: \"gray.100\",\n      padding: \"4\",\n      rounded: \"lg\",\n      overflowX: \"auto\",\n      fontSize: \"sm\",\n      lineHeight: \"1.6\",\n      borderWidth: \"1px\",\n      borderColor: \"gray.700\",\n      boxShadow: \"inset 0 0 0 1px rgba(255,255,255,0.03)\",\n    },\n    \"& pre code\": {\n      bg: \"transparent\",\n      padding: \"0\",\n      fontFamily: \"mono\",\n      color: \"inherit\",\n      borderWidth: \"0\",\n    },\n    \"& blockquote\": {\n      borderStartWidth: \"4px\",\n      borderStartColor: \"border\",\n      paddingStart: \"4\",\n    },\n    \"& ul:not([data-type='taskList'])\": {\n      paddingInlineStart: \"1rem\",\n      listStyleType: \"disc\",\n    },\n    \"& ol:not([data-type='taskList'])\": {\n      paddingInlineStart: \"1rem\",\n      listStyleType: \"decimal\",\n    },\n    \"& ul ul\": {\n      listStyleType: \"circle\",\n    },\n    \"& ul ul ul\": {\n      listStyleType: \"square\",\n    },\n    \"& ul[data-type='taskList'] li\": {\n      listStyle: \"none\",\n      display: \"flex\",\n      alignItems: \"flex-start\",\n      gap: \"2\",\n      \"& input[type='checkbox']\": {\n        accentColor: \"colorPalette.solid\",\n        marginTop: \"1\",\n      },\n    },\n    \"& hr\": { my: \"4\" },\n    \"& a\": { color: \"blue.fg\", textDecoration: \"underline\" },\n    \"& em\": { fontStyle: \"italic\" },\n    \"& strong\": { fontWeight: \"bold\" },\n    \"& p.is-editor-empty:first-of-type::before\": {\n      content: \"attr(data-placeholder)\",\n      color: \"fg.muted\",\n      pointerEvents: \"none\",\n      float: \"left\",\n      height: \"0\",\n    },\n\n    \"& .node-hashtag\": {\n      layerStyle: \"fill.surface\",\n      px: \"0.25em\",\n      py: \"2px\",\n      rounded: \"l1\",\n    },\n  },\n\n  \"&[data-disabled] .ProseMirror\": {\n    pointerEvents: \"none\",\n    opacity: 0.5,\n    cursor: \"not-allowed\",\n  },\n})\n\nexport interface RichTextEditorProps extends BoxProps {\n  editor: Editor | null\n  disabled?: boolean\n}\n\nexport const RichTextEditorRoot = React.forwardRef<\n  HTMLDivElement,\n  RichTextEditorProps\n>(function RichTextEditorRoot(props, ref) {\n  const { editor, children, css, disabled, ...rest } = props\n  const contextValue = React.useMemo(() => ({ editor }), [editor])\n  return (\n    <RichTextEditorContext.Provider value={contextValue}>\n      <Box\n        ref={ref}\n        data-disabled={disabled || undefined}\n        css={[proseMirrorBaseCss, css]}\n        {...rest}\n      >\n        {children}\n      </Box>\n    </RichTextEditorContext.Provider>\n  )\n})\n\nexport interface RichTextEditorToolbarProps extends StackProps {\n  sticky?: boolean\n  stickyOffset?: string\n}\n\nexport const RichTextEditorToolbar = React.forwardRef<\n  HTMLDivElement,\n  RichTextEditorToolbarProps\n>(function RichTextEditorToolbar(props, ref) {\n  const { sticky, stickyOffset = \"0px\", ...rest } = props\n  return (\n    <HStack\n      ref={ref}\n      py=\"1.5\"\n      px=\"3\"\n      roundedTop=\"l2\"\n      borderBottomWidth=\"1px\"\n      bg=\"bg\"\n      flexWrap=\"wrap\"\n      data-sticky={sticky || undefined}\n      separator={<StackSeparator h=\"5\" alignSelf=\"center\" />}\n      {...rest}\n      style={{\n        [\"--sticky-offset\" as string]: stickyOffset,\n        ...rest.style,\n      }}\n      css={{\n        \"&[data-sticky]\": {\n          position: \"sticky\",\n          top: \"var(--sticky-offset, 0px)\",\n          zIndex: \"1\",\n        },\n      }}\n    />\n  )\n})\n\nexport interface RichTextEditorContentProps\n  extends Omit<React.ComponentProps<typeof EditorContent>, \"editor\"> {}\n\nexport const RichTextEditorContent = React.forwardRef<\n  HTMLDivElement,\n  RichTextEditorContentProps\n>(function RichTextEditorContent(props, ref) {\n  const { editor } = useRichTextEditorContext()\n  if (!editor) return null\n  return <EditorContent editor={editor} {...props} innerRef={ref} />\n})\n\nexport interface RichTextEditorControlGroupProps extends StackProps {}\n\nexport const RichTextEditorControlGroup = React.forwardRef<\n  HTMLDivElement,\n  RichTextEditorControlGroupProps\n>(function RichTextEditorButtonGroup(props, ref) {\n  return <HStack ref={ref} gap=\"1\" {...props} />\n})\n\nexport interface BaseControlConfig {\n  label: string\n  icon?: React.ElementType\n  isDisabled?: (editor: Editor) => boolean\n}\n\nexport interface RichTextEditorControlProps\n  extends Omit<IconButtonProps, \"aria-label\"> {\n  icon: React.ReactNode\n  label: string\n}\n\nexport const RichTextEditorButtonControl = React.forwardRef<\n  HTMLButtonElement,\n  RichTextEditorControlProps\n>(function RichTextEditorButtonControl(props, ref) {\n  const { icon, label, ...rest } = props\n  return (\n    <Tooltip content={label}>\n      <IconButton ref={ref} size=\"2xs\" aria-label={label} {...rest}>\n        {icon}\n      </IconButton>\n    </Tooltip>\n  )\n})\n\n///////////////////// Boolean Control /////////////////////\n\nexport interface BooleanControlConfig extends BaseControlConfig {\n  icon: React.ElementType\n  command: (editor: Editor) => void\n  getVariant?: (editor: Editor) => IconButtonProps[\"variant\"]\n}\n\nexport function createBooleanControl(config: BooleanControlConfig) {\n  const { label, icon: Icon, isDisabled, command, getVariant } = config\n\n  const BooleanControl = React.forwardRef<HTMLButtonElement, IconButtonProps>(\n    function BooleanControl(props, ref) {\n      const { editor } = useRichTextEditorContext()\n      if (!editor) return null\n      const disabled = isDisabled ? isDisabled(editor) : false\n      const variant = getVariant ? getVariant(editor) : {}\n      return (\n        <RichTextEditorButtonControl\n          ref={ref}\n          label={label}\n          icon={<Icon />}\n          variant={variant}\n          onClick={() => command(editor)}\n          disabled={disabled}\n          {...props}\n        />\n      )\n    },\n  )\n\n  BooleanControl.displayName = `BooleanControl(${label})`\n  return BooleanControl\n}\n\n///////////////////// Select Control (with options) /////////////////////\n\nexport interface SelectOption {\n  value: string\n  label: string\n  icon?: React.ReactNode\n}\n\nexport interface SelectControlConfig extends BaseControlConfig {\n  options: SelectOption[]\n  width?: Select.RootProps[\"width\"]\n  getValue: (editor: Editor) => string\n  command: (editor: Editor, value: string) => void\n  placeholder?: string\n  renderValue?: (value: string, option?: SelectOption) => React.ReactNode\n}\n\nexport function createSelectControl(config: SelectControlConfig) {\n  const {\n    label,\n    options,\n    width,\n    getValue,\n    command,\n    placeholder = \"Select\",\n    renderValue,\n    isDisabled,\n  } = config\n\n  const SelectControl = React.forwardRef<\n    HTMLButtonElement,\n    Omit<Select.RootProps, \"collection\">\n  >(function SelectControl(props, ref) {\n    const { editor } = useRichTextEditorContext()\n    const controlId = React.useId()\n\n    if (!editor) return null\n\n    const currentValue = getValue(editor)\n    const disabled = isDisabled ? isDisabled(editor) : false\n\n    const currentOption = options.find((o) => o.value === currentValue)\n    const displayValue =\n      renderValue && currentOption\n        ? renderValue(currentValue, currentOption)\n        : currentOption?.label || placeholder\n\n    const collection = createListCollection({ items: options })\n\n    return (\n      <Select.Root\n        width={width}\n        {...props}\n        size=\"xs\"\n        variant=\"ghost\"\n        collection={collection}\n        value={[currentValue]}\n        onValueChange={(details) => command(editor, details.value[0])}\n        disabled={disabled}\n        ids={{ trigger: controlId }}\n        positioning={{ sameWidth: false }}\n        css={{\n          \"--select-trigger-height\": \"sizes.6\",\n          \"--select-trigger-padding-x\": \"spacing.2\",\n        }}\n      >\n        <Tooltip content={label} ids={{ trigger: controlId }}>\n          <Select.Trigger ref={ref}>\n            <Select.ValueText>{displayValue}</Select.ValueText>\n            <Select.Indicator />\n          </Select.Trigger>\n        </Tooltip>\n        <Portal>\n          <Select.Positioner>\n            <Select.Content minW=\"20\">\n              {options.map((opt) => (\n                <Select.Item key={opt.value} item={opt.value}>\n                  {opt.icon && (\n                    <Box as=\"span\" marginEnd=\"2\">\n                      {opt.icon}\n                    </Box>\n                  )}\n                  <Select.ItemText>{opt.label}</Select.ItemText>\n                </Select.Item>\n              ))}\n            </Select.Content>\n          </Select.Positioner>\n        </Portal>\n      </Select.Root>\n    )\n  })\n\n  SelectControl.displayName = `SelectControl(${label})`\n  return SelectControl\n}\n\n///////////////////// Swatch Control (with color swatches) /////////////////////\n\nexport interface SwatchOption {\n  value: string\n  color: string\n  label?: string\n}\nexport interface SwatchControlConfig extends BaseControlConfig {\n  swatches: SwatchOption[]\n  getValue: (editor: Editor) => string\n  command: (editor: Editor, value: string) => void\n  showRemove?: boolean\n  onRemove?: (editor: Editor) => void\n}\n\nexport function createSwatchControl(config: SwatchControlConfig) {\n  const {\n    label,\n    swatches,\n    getValue,\n    command,\n    showRemove = false,\n    onRemove,\n    isDisabled,\n    icon: Icon,\n  } = config\n\n  const SwatchControl = React.forwardRef<HTMLButtonElement, IconButtonProps>(\n    function SwatchControl(props, ref) {\n      const { editor } = useRichTextEditorContext()\n      const [open, setOpen] = React.useState(false)\n      const triggerId = React.useId()\n\n      if (!editor) return null\n      const currentValue = getValue(editor)\n      const disabled = isDisabled ? isDisabled(editor) : false\n\n      return (\n        <Popover.Root\n          open={open}\n          onOpenChange={(e) => setOpen(e.open)}\n          ids={{ trigger: triggerId }}\n          size=\"sm\"\n        >\n          <Tooltip content={label} ids={{ trigger: triggerId }}>\n            <Popover.Trigger asChild>\n              <IconButton\n                ref={ref}\n                size=\"2xs\"\n                variant=\"subtle\"\n                aria-label={label}\n                disabled={disabled}\n                {...props}\n              >\n                <VStack gap=\"1px\">\n                  {Icon && <Icon />}\n                  <ColorSwatch value={currentValue} h=\"4px\" w=\"100%\" />\n                </VStack>\n              </IconButton>\n            </Popover.Trigger>\n          </Tooltip>\n\n          <Portal>\n            <Popover.Positioner>\n              <Popover.Content width=\"auto\">\n                <Popover.Body>\n                  <HStack wrap=\"wrap\">\n                    {swatches.map((swatch) => (\n                      <ColorSwatch\n                        key={swatch.value}\n                        cursor=\"button\"\n                        value={swatch.color}\n                        onClick={() => {\n                          command(editor, swatch.value)\n                          setOpen(false)\n                        }}\n                      />\n                    ))}\n                    {showRemove && onRemove && (\n                      <Popover.CloseTrigger asChild>\n                        <CloseButton\n                          size=\"2xs\"\n                          onClick={() => {\n                            onRemove(editor)\n                            setOpen(false)\n                          }}\n                        />\n                      </Popover.CloseTrigger>\n                    )}\n                  </HStack>\n                </Popover.Body>\n              </Popover.Content>\n            </Popover.Positioner>\n          </Portal>\n        </Popover.Root>\n      )\n    },\n  )\n\n  SwatchControl.displayName = `SwatchControl(${label || \"Unnamed\"})`\n  return SwatchControl\n}\n\nexport const RichTextEditor = {\n  Root: RichTextEditorRoot,\n  Toolbar: RichTextEditorToolbar,\n  Content: RichTextEditorContent,\n  ControlGroup: RichTextEditorControlGroup,\n  ButtonControl: RichTextEditorButtonControl,\n} as const\n"
  },
  "component": "RichTextEditor"
}