{
  "type": "composition",
  "npmDependencies": [
    "@tiptap/react",
    "react-icons"
  ],
  "fileDependencies": [
    "compositions/ui/popover",
    "compositions/ui/select",
    "compositions/ui/tooltip"
  ],
  "id": "rich-text-editor",
  "file": {
    "name": "rich-text-editor.tsx",
    "content": "\"use client\"\n\nimport {\n  Box,\n  type BoxProps,\n  ColorSwatch,\n  HStack,\n  IconButton,\n  type IconButtonProps,\n  type SelectRootProps,\n  Separator,\n  type StackProps,\n  createListCollection,\n  defineStyle,\n} from \"@chakra-ui/react\"\nimport { Editor, EditorContent } from \"@tiptap/react\"\nimport {\n  PopoverBody,\n  PopoverCloseTrigger,\n  PopoverContent,\n  PopoverRoot,\n  PopoverTrigger,\n} from \"./popover\"\nimport {\n  SelectContent,\n  SelectItem,\n  SelectItemText,\n  SelectRoot,\n  SelectTrigger,\n} from \"compositions/ui/select\"\nimport { Tooltip } from \"compositions/ui/tooltip\"\nimport {\n  type ReactNode,\n  createContext,\n  forwardRef,\n  useContext,\n  useState,\n} from \"react\"\nimport { LuX } from \"react-icons/lu\"\n\nexport interface RichTextEditorContextValue {\n  editor: Editor | null\n}\n\nconst RichTextEditorContext = createContext<RichTextEditorContextValue | null>(\n  null,\n)\n\nexport function useRichTextEditorContext() {\n  const context = useContext(RichTextEditorContext)\n  if (!context) {\n    throw new Error(\n      \"useRichTextEditorContext must be used within a RichTextEditorRoot\",\n    )\n  }\n  return context\n}\n\nconst proseMirrorBaseCss = defineStyle({\n  \"& .ProseMirror\": {\n    outline: \"none\",\n    \"& > * + *\": { marginTop: \"0.75em\" },\n    \"& h1\": { fontSize: \"2xl\", fontWeight: \"bold\" },\n    \"& h2\": { fontSize: \"xl\", fontWeight: \"bold\" },\n    \"& h3\": { fontSize: \"lg\", fontWeight: \"bold\" },\n    \"& code\": {\n      bg: \"bg.muted\",\n      px: \"1\",\n      rounded: \"sm\",\n      fontFamily: \"mono\",\n      fontSize: \"0.9em\",\n    },\n    \"& pre\": {\n      bg: \"gray.900\",\n      color: \"gray.100\",\n      padding: \"4\",\n      rounded: \"lg\",\n      overflowX: \"auto\",\n      fontSize: \"sm\",\n      lineHeight: \"1.6\",\n      borderWidth: \"1px\",\n      borderColor: \"gray.700\",\n      boxShadow: \"inset 0 0 0 1px rgba(255,255,255,0.03)\",\n    },\n    \"& pre code\": {\n      bg: \"transparent\",\n      padding: \"0\",\n      fontFamily: \"mono\",\n      color: \"inherit\",\n    },\n    \"& blockquote\": {\n      borderStartWidth: \"4px\",\n      borderStartColor: \"border\",\n      paddingStart: \"4\",\n      fontStyle: \"italic\",\n    },\n    \"& ul\": { paddingInlineStart: \"4\", listStyleType: \"disc\" },\n    \"& ol\": { paddingInlineStart: \"4\", listStyleType: \"decimal\" },\n    \"& ul ul\": { listStyleType: \"circle\" },\n    \"& ul ul ul\": { listStyleType: \"square\" },\n    \"& ul[data-type='taskList'] li\": {\n      listStyle: \"none\",\n      display: \"flex\",\n      alignItems: \"flex-start\",\n      gap: \"2\",\n      \"& input[type='checkbox']\": {\n        accentColor: \"colorPalette.solid\",\n        marginTop: \"1\",\n      },\n      \"& ul[data-type='taskList']\": { paddingLeft: \"6\" },\n    },\n    \"& hr\": { my: \"4\" },\n    \"& a\": { color: \"fg.link\", textDecoration: \"underline\" },\n    \"& em\": { fontStyle: \"italic\" },\n    \"& p[data-placeholder]::before\": {\n      content: \"attr(data-placeholder)\",\n      color: \"fg.muted\",\n      pointerEvents: \"none\",\n      userSelect: \"none\",\n    },\n  },\n})\n\nexport interface RichTextEditorProps extends BoxProps {\n  editor: Editor | null\n  isDisabled?: boolean\n}\n\nexport function RichTextEditorRoot({\n  editor,\n  children,\n  css,\n  isDisabled = false,\n  ...rest\n}: RichTextEditorProps) {\n  return (\n    <RichTextEditorContext.Provider value={{ editor }}>\n      <Box\n        data-disabled={isDisabled || undefined}\n        css={[\n          proseMirrorBaseCss,\n          {\n            \"&[data-disabled='true'] .ProseMirror\": {\n              pointerEvents: \"none\",\n              opacity: 0.5,\n              cursor: \"not-allowed\",\n            },\n            \"&[data-disabled='false'] .ProseMirror\": {\n              pointerEvents: \"auto\",\n              opacity: 1,\n              cursor: \"text\",\n            },\n          },\n          css,\n        ]}\n        {...rest}\n      >\n        {children}\n      </Box>\n    </RichTextEditorContext.Provider>\n  )\n}\n\nexport interface RichTextEditorContentProps extends BoxProps {}\n\nexport const RichTextEditorContent = forwardRef<\n  HTMLDivElement,\n  RichTextEditorContentProps\n>(function RichTextEditorContent(props, ref) {\n  const { editor } = useRichTextEditorContext()\n  if (!editor) return null\n  return (\n    <Box ref={ref} minH=\"300px\" p=\"5\" {...props}>\n      <EditorContent editor={editor} />\n    </Box>\n  )\n})\n\nexport interface RichTextEditorButtonGroupProps extends StackProps {\n  noSeparator?: boolean\n}\n\nexport const RichTextEditorButtonGroup = forwardRef<\n  HTMLDivElement,\n  RichTextEditorButtonGroupProps\n>(function ButtonGroup({ children, noSeparator = false, ...rest }, ref) {\n  if (!children) return null\n  return (\n    <HStack ref={ref} {...rest}>\n      {children}\n      {!noSeparator && <Separator orientation=\"vertical\" alignSelf=\"stretch\" />}\n    </HStack>\n  )\n})\n\nexport interface BaseControlConfig {\n  label: string\n  icon?: React.ElementType\n  isDisabled?: (editor: Editor) => boolean\n}\n\nexport interface ButtonControlConfig extends BaseControlConfig {\n  icon: React.ElementType\n  command: (editor: Editor) => void\n  getVariant?: (editor: Editor) => IconButtonProps[\"variant\"]\n}\n\nexport interface RichTextEditorControlProps\n  extends Omit<IconButtonProps, \"aria-label\"> {\n  icon: ReactNode\n  label: string\n}\n\nexport const RichTextEditorButtonControl = forwardRef<\n  HTMLButtonElement,\n  RichTextEditorControlProps\n>(function ButtonControl({ icon, label, ...rest }, ref) {\n  return (\n    <Tooltip content={label}>\n      <IconButton ref={ref} size=\"xs\" aria-label={label} {...rest}>\n        {icon}\n      </IconButton>\n    </Tooltip>\n  )\n})\n\nexport function createButtonControl(config: ButtonControlConfig) {\n  const { label, icon: Icon, isDisabled, command, getVariant } = config\n\n  const ButtonControl = forwardRef<HTMLButtonElement, IconButtonProps>(\n    (props, ref) => {\n      const { editor } = useRichTextEditorContext()\n      if (!editor) return null\n      const disabled = isDisabled ? isDisabled(editor) : false\n      const variant = getVariant ? getVariant(editor) : {}\n      return (\n        <RichTextEditorButtonControl\n          ref={ref}\n          label={label}\n          icon={<Icon />}\n          variant={variant}\n          onClick={() => command(editor)}\n          disabled={disabled}\n          {...props}\n        />\n      )\n    },\n  )\n\n  ButtonControl.displayName = `ButtonControl(${label})`\n  return ButtonControl\n}\n\nexport interface SelectOption {\n  value: string\n  label: string\n  icon?: React.ReactNode\n}\n\nexport interface SelectControlConfig extends BaseControlConfig {\n  options: SelectOption[]\n  getValue: (editor: Editor) => string\n  command: (editor: Editor, value: string) => void\n  placeholder?: string\n  renderValue?: (value: string, option?: SelectOption) => ReactNode\n}\n\nexport function createSelectControl(config: SelectControlConfig) {\n  const {\n    label,\n    options,\n    getValue,\n    command,\n    placeholder = \"Select\",\n    renderValue,\n    isDisabled,\n  } = config\n\n  const SelectControl = forwardRef<\n    HTMLButtonElement,\n    Omit<SelectRootProps, \"collection\">\n  >((props, ref) => {\n    const { editor } = useRichTextEditorContext()\n    if (!editor) return null\n    const currentValue = getValue(editor)\n    const disabled = isDisabled ? isDisabled(editor) : false\n    const currentOption = options.find((o) => o.value === currentValue)\n    const displayValue =\n      renderValue && currentOption\n        ? renderValue(currentValue, currentOption)\n        : currentOption?.label || placeholder\n\n    const collection = createListCollection({\n      items: options.map((o) => ({\n        label: o.label,\n        value: o.value,\n        icon: o.icon,\n      })),\n    })\n\n    return (\n      <SelectRoot\n        {...props}\n        collection={collection}\n        value={[currentValue]}\n        onValueChange={(details) => command(editor, details.value[0])}\n        disabled={disabled}\n      >\n        <Tooltip content={label}>\n          <Box as=\"span\">\n            <SelectTrigger ref={ref}>{displayValue}</SelectTrigger>\n          </Box>\n        </Tooltip>\n        <SelectContent>\n          {options.map((opt) => (\n            <SelectItem key={opt.value} item={opt.value}>\n              {opt.icon && (\n                <Box as=\"span\" mr=\"2\">\n                  {opt.icon}\n                </Box>\n              )}\n              <SelectItemText>{opt.label}</SelectItemText>\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </SelectRoot>\n    )\n  })\n\n  SelectControl.displayName = `SelectControl(${label})`\n  return SelectControl\n}\n\nexport interface SwatchOption {\n  value: string\n  color: string\n  label?: string\n}\nexport interface SwatchControlConfig extends BaseControlConfig {\n  swatches: SwatchOption[]\n  getValue: (editor: Editor) => string\n  command: (editor: Editor, value: string) => void\n  columns?: number\n  showRemove?: boolean\n  onRemove?: (editor: Editor) => void\n}\n\nexport function createSwatchControl(config: SwatchControlConfig) {\n  const {\n    label,\n    swatches,\n    getValue,\n    command,\n    columns = 7,\n    showRemove = false,\n    onRemove,\n    isDisabled,\n    icon: Icon,\n  } = config\n\n  const SwatchControl = forwardRef<HTMLButtonElement, IconButtonProps>(\n    (props, ref) => {\n      const { editor } = useRichTextEditorContext()\n      const [open, setOpen] = useState(false)\n      if (!editor) return null\n      const currentValue = getValue(editor)\n      const disabled = isDisabled ? isDisabled(editor) : false\n\n      return (\n        <PopoverRoot open={open} onOpenChange={(e) => setOpen(e.open)}>\n          <PopoverTrigger asChild>\n            <Box as=\"span\">\n              <RichTextEditorButtonControl\n                ref={ref}\n                label={label}\n                icon={\n                  Icon ? <Icon /> : <Box bg={currentValue} w=\"100%\" h=\"100%\" />\n                }\n                bg={currentValue}\n                disabled={disabled}\n                {...props}\n              />\n            </Box>\n          </PopoverTrigger>\n\n          <PopoverContent>\n            <PopoverBody>\n              <Box\n                display=\"grid\"\n                gridTemplateColumns={`repeat(${columns}, 1fr)`}\n                gap={1}\n              >\n                {swatches.map((s) => (\n                  <Tooltip key={s.value} content={s.label || s.value}>\n                    <ColorSwatch\n                      cursor=\"button\"\n                      value={s.color}\n                      onClick={() => {\n                        command(editor, s.value)\n                        setOpen(false)\n                      }}\n                    />\n                  </Tooltip>\n                ))}\n              </Box>\n              {showRemove && onRemove && (\n                <HStack justify=\"flex-end\" mt={2}>\n                  <PopoverCloseTrigger asChild>\n                    <IconButton\n                      aria-label=\"Remove\"\n                      onClick={() => {\n                        onRemove(editor)\n                        setOpen(false)\n                      }}\n                    >\n                      <LuX />\n                    </IconButton>\n                  </PopoverCloseTrigger>\n                </HStack>\n              )}\n            </PopoverBody>\n          </PopoverContent>\n        </PopoverRoot>\n      )\n    },\n  )\n\n  SwatchControl.displayName = `SwatchControl(${label || \"Unnamed\"})`\n  return SwatchControl\n}\n"
  },
  "component": "RichTextEditor"
}